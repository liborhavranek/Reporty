{% extends "base.html" %}
{% block title %}{{ project.name }} – Projekt{% endblock %}

{% block content %}
<section class="hero-report full admin-dense project-page project-hero">
  <!-- grid vrstva pod obsahem -->
  <div class="hero-grid" aria-hidden="true"></div>

  <div class="project-wrap board-layout">
    <!-- LEVÝ INDEX -->
    <aside class="side-index">
      <div class="side-card">
        <h3 class="side-title">Projekt</h3>
        <div class="kv-pair"><span class="kv-label">Typ</span><span class="kv-value">{{ project.type.value|upper }}</span></div>
        {% set v = project.visibility.value %}
        <div class="kv-pair"><span class="kv-label">Viditelnost</span><span class="kv-value">{{ 'PUBLIC' if v=='public' else ('LINK' if v=='link-only' else 'PRIVATE') }}</span></div>

        {% set ns = namespace(total=0) %}
        {% for s in sections %}{% set ns.total = ns.total + (children.get(s.id, []) | length) %}{% endfor %}
        <div class="kv-pair"><span class="kv-label">Sekce</span><span class="kv-value">{{ sections|length }}</span></div>
        <div class="kv-pair"><span class="kv-label">Sekvence</span><span class="kv-value">{{ ns.total }}</span></div>
      </div>

      {% if sections %}
      <div class="side-card">
        <h3 class="side-title">Sekce</h3>
        <ul class="index-list">
          {% for s in sections %}
            {% set cnt = (children.get(s.id, []) | length) %}
            <li>
              <a class="idx-link" href="#sec-{{ s.id }}">
                <span class="idx-left">
                  <span class="idx-dot"></span>
                  <span class="idx-name">{{ s.name }}</span>
                </span>
                <span class="idx-count">{{ "%02d"|format(cnt) }}</span>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </aside>

    <!-- PRAVÝ BOARD -->
    <div class="board">
      <!-- Header karta projektu (glass shield) -->
<header class="project-header card-shield" aria-labelledby="project-title">
  <div class="hgroup">
    {% if project.logo_path %}
      <img src="{{ url_for('bp.storage_logos', filename=project.logo_path) }}" alt="" class="logo">
    {% else %}
      <div class="logo placeholder">{{ project.name[:1] }}</div>
    {% endif %}
    <div>
      <div class="eyebrow">Projekt</div>
      <h1 id="project-title" class="title">{{ project.name }}</h1>
      {% if project.description %}<p class="sub">{{ project.description }}</p>{% endif %}
    </div>
  </div>

  <div class="meta">
    <span class="chip">Sekce: <b class="mono">{{ sections|length }}</b></span>
    <span class="chip">Sekvence: <b class="mono">{{ ns.total }}</b></span>
    <a class="btn btn-ghost" href="{{ url_for('bp.public_projects_list') }}">← Zpět na projekty</a>
  </div>
</header>

      {% if sections %}
        {% for s in sections %}
          {% set seqs = children.get(s.id, []) %}
          <!-- SLAB sekce -->
          <section id="sec-{{ s.id }}" class="section-slab card-shield">
<div class="slab-head">
  <div class="slab-titlebox">
    <h2 class="slab-title">{{ s.name }}</h2>
    {% if s.description %}<p class="slab-desc">{{ s.description }}</p>{% endif %}
  </div>
  <div class="slab-meta">
    <span class="slab-chip">Sekvence: <span class="v">{{ seqs|length }}</span></span>
  </div>
</div>

            {% if seqs %}
              <div class="seq-rows">
                {% for ch in seqs %}
                  <div class="seq-row">
                    <div class="seq-main">
                      <span class="seq-dot"></span>
                      <div>
                        <div class="seq-name ellip" title="{{ ch.name }}">{{ ch.name }}</div>
                        {% if ch.description %}<div class="seq-desc">{{ ch.description }}</div>{% endif %}
                      </div>
                    </div>
                    <div class="seq-actions">
                      <a class="btn btn-ghost btn-sm" href="{{ url_for('bp.runs_list', project_id=project.id, suite_id=ch.id) }}">Zobrazit</a>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <p class="sub">Žádné sekvence.</p>
            {% endif %}
          </section>
        {% endfor %}
      {% else %}
        <div class="empty"><p class="sub">Zatím žádné sekce.</p></div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
